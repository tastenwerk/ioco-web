include ../web_elements/tmpl

span.icn.icn-gear.icn-no-border.pale(style="position:absolute;top:5px;right:5px")
#tabstrip.ioco-tabs
  ul
    li.k-state-active
      span=t('articles.mine')
    li
      span=t('articles.waiting')
    li
      span=t('articles.published')

  div
    h4
      a.icnbtn( href='/articles/new', data-remote='true' )
        i.icn.icn-plus

    #articles-mine-view.articles-view.ioco-list(style='margin-top: 35px')

    script
      var myArticlesSrc = new kendo.data.DataSource({
          transport: {
            read: {
              url: ioco.host.native+'/web_elements',
              type: "get",
              dataType: "json",
              data: {
                _subtype: 'Article',
                mine: true
              }
            }
          }
      });

      $("#articles-mine-view").kendoListView({
          dataSource: myArticlesSrc,
          pageable: false,
          template: kendo.template($("#kendo-webpage-template").html())
      });

  div
    h4
      a.icnbtn( href='/articles/new', data-remote='true' )
        i.icn.icn-plus

    #articles-all-view.articles-view.ioco-list

    script
      var allArticlesSrc = new kendo.data.DataSource({
          transport: {
            read: {
              url: ioco.host.native+'/web_elements',
              type: "get",
              dataType: "json",
              data: {
                _subtype: 'Article',
                waiting: false
              }
            }
          }
      });

      $("#articles-all-view").kendoListView({
          dataSource: allArticlesSrc,
          pageable: false,
          template: kendo.template($("#kendo-webpage-template").html())
      });

  div
    h4
      a.icnbtn( href='/articles/new', data-remote='true' )
        i.icn.icn-plus

    #articles-waiting-view.articles-view.ioco-list

    include ../web_elements/tmpl

    script
      var waitingArticlesSrc = new kendo.data.DataSource({
          transport: {
            read: {
              url: ioco.host.native+'/web_elements',
              type: "get",
              dataType: "json",
              data: {
                _subtype: 'Article',
                waiting: true
              }
            }
          }
      });

      $("#articles-waiting-view").kendoListView({
          dataSource: waitingArticlesSrc,
          pageable: false,
          template: kendo.template($("#kendo-webpage-template").html())
      });

script
  $("#tabstrip").kendoTabStrip({
    animation:  {
      open: {
        effects: "fadeIn"
      }
    }
  });
  $('.articles-view .delete').live('click', function( e ){
    e.preventDefault();
    var treeView = $('#ioco-folders').data('kendoTreeView');
    var uid = $(this).closest('li').attr('data-uid');
    var item = treeView.dataSource.getByUid( uid );

    $.ajax({ url: '/documents/' + item._id,
      type: 'delete',
      dataType: 'json',
      data: { _csrf: $('#_csrf').val() },
      success: function( data ){
        if( data.flash && data.flash.notice && data.flash.notice.length > 0 )
          treeView.detach( treeView.findByUid( uid ) );
        ioco.notify( data.flash );
      }
    })
  });

